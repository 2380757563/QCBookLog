# é‡å¯æœåŠ¡æŒ‡å—

## é—®é¢˜
å‰ç«¯è¯·æ±‚çš„APIæ²¡æœ‰è¢«æ­£ç¡®ä»£ç†åˆ°åç«¯æœåŠ¡å™¨ï¼Œå¯¼è‡´"no such table: main.books"é”™è¯¯ã€‚

## è§£å†³æ–¹æ¡ˆ

### 1. åœæ­¢æ‰€æœ‰æœåŠ¡

æŒ‰ `Ctrl + C` åœæ­¢å½“å‰è¿è¡Œçš„æ‰€æœ‰ç»ˆç«¯çª—å£ä¸­çš„æœåŠ¡ã€‚

### 2. å¯åŠ¨åç«¯æœåŠ¡å™¨

æ‰“å¼€ä¸€ä¸ªæ–°çš„ç»ˆç«¯çª—å£ï¼Œè¿è¡Œï¼š

```bash
cd d:\ä¸‹è½½\docs-xmnote-master\QC-booklog\server
npm run dev
```

ç­‰å¾…çœ‹åˆ°ä»¥ä¸‹è¾“å‡ºï¼Œè¡¨ç¤ºåç«¯å¯åŠ¨æˆåŠŸï¼š

```
âœ… better-sqlite3 å¯¼å…¥æˆåŠŸ
ğŸ”„ åˆå§‹åŒ– Calibre æ•°æ®åº“è¿æ¥...
âœ… Calibre æ•°æ®åº“è¿æ¥æˆåŠŸ
ğŸ”„ åˆå§‹åŒ– Talebook æ•°æ®åº“è¿æ¥...
âœ… Talebook æ•°æ®åº“è¿æ¥æˆåŠŸ
âœ… qcbooklog ä¸“å±è¡¨ç»“æ„åˆå§‹åŒ–å®Œæˆ
âœ… qc_reading_records è¡¨åˆ›å»ºå®Œæˆ
âœ… qc_daily_reading_stats è¡¨åˆ›å»ºå®Œæˆ
âœ… qc_bookdata è¡¨åˆ›å»ºå®Œæˆ
ğŸ“‹ å¼€å§‹åˆå§‹åŒ– qcbooklog ä¸“å±è¡¨ç»“æ„
âœ… users è¡¨åˆ›å»ºæˆåŠŸ
âœ… é»˜è®¤ç”¨æˆ·å·²åˆ›å»º
âœ… qc_bookdata è¡¨å·²åŒ…å«æ‰€æœ‰å¿…è¦å­—æ®µ
```

**ä¿æŒè¿™ä¸ªç»ˆç«¯çª—å£æ‰“å¼€ï¼**

### 3. å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨

æ‰“å¼€å¦ä¸€ä¸ªæ–°çš„ç»ˆç«¯çª—å£ï¼Œè¿è¡Œï¼š

```bash
cd d:\ä¸‹è½½\docs-xmnote-master\QC-booklog
npm run dev
```

ç­‰å¾…çœ‹åˆ°ä»¥ä¸‹è¾“å‡ºï¼Œè¡¨ç¤ºå‰ç«¯å¯åŠ¨æˆåŠŸï¼š

```
  VITE v5.x.x  ready in xxx ms

  âœ  Local:   http://localhost:7403/
  âœ  Network: use --host to expose
  âœ  press h + enter to show help
```

### 4. éªŒè¯æœåŠ¡çŠ¶æ€

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®ï¼š
- å‰ç«¯ï¼šhttp://localhost:7403
- åç«¯APIï¼ˆå¥åº·æ£€æŸ¥ï¼‰ï¼šhttp://localhost:7401/api/health

### 5. æµ‹è¯•é˜…è¯»è®°å½•åŠŸèƒ½

1. æ‰“å¼€ http://localhost:7403
2. é€‰æ‹©ä¸€æœ¬ä¹¦ï¼Œè¿›å…¥é˜…è¯»ç•Œé¢
3. ç‚¹å‡»"å¼€å§‹é˜…è¯»"
4. ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼ˆæ¯”å¦‚30ç§’ï¼‰
5. ç‚¹å‡»"ç»“æŸé˜…è¯»"
6. æ£€æŸ¥æ˜¯å¦æˆåŠŸä¿å­˜

## é‡è¦æç¤º

### ç«¯å£è¯´æ˜

- **å‰ç«¯å¼€å‘æœåŠ¡å™¨**ï¼š7403ç«¯å£
- **åç«¯APIæœåŠ¡å™¨**ï¼š7401ç«¯å£

### Viteä»£ç†é…ç½®

å‰ç«¯é€šè¿‡Viteä»£ç†å°†APIè¯·æ±‚è½¬å‘åˆ°åç«¯ï¼š

```
å‰ç«¯è¯·æ±‚: http://localhost:7403/api/reading/record
              â†“ Viteä»£ç†
åç«¯æ¥æ”¶: http://localhost:7401/api/reading/record
```

### å¸¸è§é—®é¢˜

**Q: ä»ç„¶æ˜¾ç¤º "no such table: main.books" é”™è¯¯**

A: è¯·æ£€æŸ¥ï¼š
1. åç«¯æœåŠ¡å™¨æ˜¯å¦æ­£åœ¨è¿è¡Œåœ¨7401ç«¯å£
2. å‰ç«¯å¼€å‘æœåŠ¡å™¨æ˜¯å¦æ­£åœ¨è¿è¡Œåœ¨7403ç«¯å£
3. æŸ¥çœ‹åç«¯æ§åˆ¶å°æ˜¯å¦æœ‰æ•°æ®åº“è¿æ¥é”™è¯¯

**Q: å¦‚ä½•ç¡®è®¤ä»£ç†æ˜¯å¦ç”Ÿæ•ˆï¼Ÿ**

A:
1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
2. åˆ‡æ¢åˆ°"ç½‘ç»œ"æ ‡ç­¾
3. å‘é€ä¸€ä¸ªAPIè¯·æ±‚ï¼ˆå¦‚ä¿å­˜é˜…è¯»è®°å½•ï¼‰
4. æŸ¥çœ‹è¯·æ±‚URLï¼š
   - å¦‚æœæ˜¯ `http://localhost:7403/api/reading/record`ï¼Œè¯´æ˜ä»£ç†æœªç”Ÿæ•ˆ
   - å¦‚æœæ˜¯ `http://localhost:7403/api/reading/record`ï¼ˆä½†çŠ¶æ€ç 200ï¼‰ï¼Œè¯´æ˜ä»£ç†ç”Ÿæ•ˆäº†
5. æ£€æŸ¥"å“åº”"æ ‡ç­¾ï¼Œå¦‚æœè¿”å›äº†JSONæ•°æ®ï¼Œè¯´æ˜åç«¯æ­£å¸¸å“åº”

## æ•…éšœæ’æŸ¥

### æ£€æŸ¥åç«¯æ—¥å¿—

åœ¨åç«¯ç»ˆç«¯çª—å£ä¸­æŸ¥çœ‹æ—¥å¿—è¾“å‡ºï¼Œåº”è¯¥çœ‹åˆ°ï¼š

```
ğŸ“ å‡†å¤‡æ’å…¥é˜…è¯»è®°å½•: bookId=xxx, readerId=0
ğŸ“ SQL æŸ¥è¯¢: INSERT INTO qc_reading_records ...
âœ… åˆ›å»ºé˜…è¯»è®°å½•: ID=xxx, ä¹¦ç±ID=xxx, æ—¶é•¿=xxåˆ†é’Ÿ
âœ… æ›´æ–°ä¹¦ç±é˜…è¯»ç»Ÿè®¡: ä¹¦ç±ID=xxx, æ€»æ—¶é•¿+xxåˆ†é’Ÿ, æ€»é¡µæ•°+xxé¡µ
âœ… æ›´æ–°æ¯æ—¥é˜…è¯»ç»Ÿè®¡: æ—¥æœŸ=xxxx-xx-xx, ä¹¦ç±+1, é¡µæ•°+xx, æ—¶é•¿+xxåˆ†é’Ÿ
```

### æ£€æŸ¥å‰ç«¯æ—¥å¿—

åœ¨å‰ç«¯ç»ˆç«¯çª—å£ä¸­ï¼Œåº”è¯¥çœ‹åˆ°Viteä»£ç†çš„æ—¥å¿—ï¼ˆå¦‚æœå¼€å¯äº†è¯¦ç»†æ—¥å¿—ï¼‰ï¼š

```
[vite] http://localhost:7403/api/reading/record -> http://localhost:7401/api/reading/record
```

### å¦‚æœç«¯å£è¢«å ç”¨

**7401ç«¯å£è¢«å ç”¨ï¼š**
```bash
# æŸ¥æ‰¾å ç”¨7401ç«¯å£çš„è¿›ç¨‹
netstat -ano | findstr :7401

# ç»“æŸè¿›ç¨‹ï¼ˆå°†PIDæ›¿æ¢ä¸ºå®é™…çš„è¿›ç¨‹IDï¼‰
taskkill /PID <PID> /F
```

**7403ç«¯å£è¢«å ç”¨ï¼š**
```bash
# æŸ¥æ‰¾å ç”¨7403ç«¯å£çš„è¿›ç¨‹
netstat -ano | findstr :7403

# ç»“æŸè¿›ç¨‹ï¼ˆå°†PIDæ›¿æ¢ä¸ºå®é™…çš„è¿›ç¨‹IDï¼‰
taskkill /PID <PID> /F
```

## é…ç½®æ£€æŸ¥

### vite.config.ts ç¡®è®¤

ç¡®ä¿ `vite.config.ts` ä¸­æœ‰ä»¥ä¸‹é…ç½®ï¼š

```typescript
server: {
  host: '0.0.0.0',
  port: 7403,
  strictPort: true,
  proxy: {
    '/api/reading': {
      target: 'http://localhost:7401',
      changeOrigin: true,
      rewrite: (path) => path
    },
    // ... å…¶ä»–ä»£ç†é…ç½®
  }
}
```

### app.js ç¡®è®¤

ç¡®ä¿ `server/app.js` ä¸­æœ‰ä»¥ä¸‹é…ç½®ï¼š

```javascript
const PORT = process.env.PORT || 7401;
```
